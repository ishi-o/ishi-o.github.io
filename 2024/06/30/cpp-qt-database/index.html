<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=consolas:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ishi-o.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"github","dark":"github-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="Qt: 数据库连接">
<meta property="og:url" content="https://ishi-o.github.io/2024/06/30/cpp-qt-database/index.html">
<meta property="og:site_name" content="Ishio">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-06-30T00:00:00.000Z">
<meta property="article:modified_time" content="2025-12-06T07:59:44.167Z">
<meta property="article:author" content="ishio">
<meta property="article:tag" content="Qt">
<meta property="article:tag" content="databse">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ishi-o.github.io/2024/06/30/cpp-qt-database/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://ishi-o.github.io/2024/06/30/cpp-qt-database/","path":"2024/06/30/cpp-qt-database/","title":"Qt: 数据库连接"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Qt: 数据库连接 | Ishio</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ishio</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.</span> <span class="nav-text">数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql%E6%A0%87%E5%87%86"><span class="nav-number">1.2.</span> <span class="nav-text">SQL标准</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%82%E7%A2%8E%E7%9F%A5%E8%AF%86"><span class="nav-number">1.2.1.</span> <span class="nav-text">杂碎知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.2.2.</span> <span class="nav-text">常用数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.2.3.</span> <span class="nav-text">查询语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%A1%A8%E5%86%85%E5%AE%B9%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">1.2.4.</span> <span class="nav-text">对表内容的操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%A1%A8%E6%95%B4%E4%BD%93%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">1.2.5.</span> <span class="nav-text">对表整体的操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E5%88%86%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">1.2.6.</span> <span class="nav-text">部分关键字</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#qt-sql"><span class="nav-number">1.3.</span> <span class="nav-text">Qt Sql</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.3.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#qsqldatabase"><span class="nav-number">1.3.2.</span> <span class="nav-text">QSqlDatabase</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#qt-query"><span class="nav-number">1.3.3.</span> <span class="nav-text">Qt Query</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#qt-modelviewdelegate"><span class="nav-number">1.3.4.</span> <span class="nav-text">Qt Model&#x2F;View&#x2F;Delegate</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#qsqltablemodelqtableview"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">QSqlTableModel&#x2F;QTableView</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#qstandarditemmodelqtreeview"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">QStandardItemModel&#x2F;QTreeView</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ishio</p>
  <div class="site-description" itemprop="description">Just for fun!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">132</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">89</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ishi-o" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ishi-o" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    Related Posts
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/06/02/java-jdbc/" rel="bookmark">
        <time class="popular-posts-time">2025-06-02</time>
        <br>
      Java: JDBC编程
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/04/20/sql-std/" rel="bookmark">
        <time class="popular-posts-time">2025-04-20</time>
        <br>
      SQL: 基本用法
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2024/06/27/cpp-qt-beginner/" rel="bookmark">
        <time class="popular-posts-time">2024-06-27</time>
        <br>
      Qt: 基本用法
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/11/26/Rlang-beginner/" rel="bookmark">
        <time class="popular-posts-time">2025-11-26</time>
        <br>
      Rlang: 虽然不知道为什么要学
      </a>
    </li>
  </ul>

          </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://ishi-o.github.io/2024/06/30/cpp-qt-database/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ishio">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ishio">
      <meta itemprop="description" content="Just for fun!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Qt: 数据库连接 | Ishio">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Qt: 数据库连接
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-06-30 00:00:00" itemprop="dateCreated datePublished" datetime="2024-06-30T00:00:00+00:00">2024-06-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-12-06 07:59:44" itemprop="dateModified" datetime="2025-12-06T07:59:44+00:00">2025-12-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/C-Cpp/" itemprop="url" rel="index"><span itemprop="name">C/Cpp</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Programming/C-Cpp/Qt/" itemprop="url" rel="index"><span itemprop="name">Qt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>2.8k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>10 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><!-- placeholder -->
<span id="more"></span>
<h1 id="数据库">数据库</h1>
<h2 id="介绍">介绍</h2>
<p>数据库分两种，关系型(<code>Relational Database</code>)和非关系型(<code>Not Only SQL</code>)，它们的区别：</p>
<ul>
<li><code>RDBMS</code>：使用表格存储数据；具有强大的查询性能；但只能存储在硬盘，读写性能较差</li>
<li><code>NoSQL</code>：提供多种存储数据的结构；不支持<code>SQL</code>，查询方面差；但可使用<code>RAM</code>，数据量大时有优势</li>
</ul>
<p>数据库必须符合<code>ACID</code>：</p>
<ul>
<li><code>Atomicity</code>：事务若执行失败，数据库能恢复到事务开始前的状态</li>
<li><code>Consistency</code>：写入的数据必须符合预设规则，否则事务执行失败</li>
<li><code>Isolation</code>：允许并发事务的存在，是线程安全的</li>
<li><code>Durability</code>：数据及其修改是永久存在的(体现在保存于硬盘上)</li>
</ul>
<p><code>SQL</code>(<code>Structured Query Language</code>，结构化查询语言)是用于操作数据库的语言</p>
<p>不同数据库提供的<code>SQL</code>不一样，所以常出现在数据库的名字里</p>
<p>目前常用的开源数据库有：</p>
<ul>
<li><code>SQLite</code>：轻量的数据库</li>
<li><code>MySQL</code></li>
<li><code>PostegreSQL</code></li>
</ul>
<p><a
target="_blank" rel="noopener" href="https://blog.csdn.net/qq_54621492/article/details/139901605"><code>Navicat</code></a>是一款能直观地操作数据库的应用</p>
<h2 id="sql标准"><code>SQL</code>标准</h2>
<h3 id="杂碎知识">杂碎知识</h3>
<ul>
<li>虽然不同数据库的<code>SQL</code>语法有差别(实现上也不同)，但它们都遵循<code>SQL</code>标准</li>
<li><code>SQL</code>是不区分大小写的</li>
<li>称表的一行为一条记录</li>
<li>通过<code>CREATE DATABASE dbName</code>创建数据库</li>
<li>文本数据需要添加单引号或双引号；当文本数据是一个数字时，需要仔细检查</li>
</ul>
<h3 id="常用数据类型">常用数据类型</h3>
<ul>
<li>文本类型：
<ul>
<li><code>CHAR(N)</code>：长度固定为<code>N</code>的字符串，文本长度不足则用空格补充，<code>N</code>最长一般为<code>65535</code></li>
<li><code>VARCHAR(N)</code>：长度可变的字符串，最长为<code>N</code></li>
<li><code>TEXT</code>：适用于长文本</li>
</ul></li>
<li>数值类型：
<ul>
<li><code>INT/INTEGER</code>：<code>4</code>字节整型</li>
<li><code>SMALLINT</code>：<code>2</code>字节整型</li>
<li><code>BIGINT</code>：<code>8</code>字节整型</li>
<li><code>FLOAT(D)</code>：小数位最多为<code>D</code>的浮点数</li>
<li><code>DECIMAL(M, D)</code>：总位数为<code>M</code>，小数位数为<code>D</code>的浮点数</li>
</ul></li>
<li>时间类型：
<ul>
<li><code>DATE</code>：存储日期<code>YYYY-MM-DD</code></li>
<li><code>TIME</code>：存储时间<code>HH:MM:SS</code></li>
<li><code>DATETIME</code>：存储日期时间<code>YYYY-MM-DD HH:MM:SS</code></li>
</ul></li>
<li>其它：
<ul>
<li><code>BLOB</code>：存储大量二进制数据(如图片、音频等)</li>
<li><code>ENUM</code>：枚举类型</li>
</ul></li>
</ul>
<h3 id="查询语句">查询语句</h3>
<p>查询结果是类似于表的结构，对数据库的许多操作需要配合查询语句一起使用</p>
<p><strong><code>SELECT</code>系列语句用于确定列，<code>WHERE</code>系列语句用于确定行</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 查询列</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tableName;    # 查询整个表</span><br><span class="line"><span class="keyword">SELECT</span> columnNameList <span class="keyword">FROM</span> tableName; # 查询特定列, 列间用逗号隔开</span><br><span class="line"></span><br><span class="line"># 查询时过滤记录</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> ... ;     # <span class="keyword">DISTINCT</span>: 查询后,自动去除完全重复的记录</span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">WHERE</span> <span class="keyword">condition</span>;    # <span class="keyword">WHERE</span> <span class="keyword">condition</span>: 按<span class="keyword">condition</span>过滤记录</span><br><span class="line"></span><br><span class="line"># <span class="keyword">condition</span>的编写: 在查询时, 若表达式返回真, 则加入查询结果</span><br><span class="line"># 格式          返回真的情况</span><br><span class="line">columnName <span class="operator">&gt;</span><span class="operator">/</span><span class="operator">=</span><span class="operator">/</span><span class="operator">&lt;</span> <span class="keyword">value</span>     # 和值比较</span><br><span class="line">columnName <span class="keyword">IS</span> <span class="keyword">NULL</span>      # 空值</span><br><span class="line">columnName <span class="keyword">BETWEEN</span> val1 <span class="keyword">AND</span> val2  # 介于val1, val2间的值</span><br><span class="line">columnName <span class="keyword">IN</span> (val1, ...)    # 等于括号内任意值</span><br><span class="line">columnName <span class="keyword">LIKE</span> val      # <span class="keyword">LIKE</span>模糊查询</span><br><span class="line">columnName REGEXP val     # 正则表达式匹配</span><br><span class="line">columnName GLOB val      # SQLite支持GLOB匹配</span><br><span class="line"></span><br><span class="line"># <span class="keyword">condition</span>语句编写</span><br><span class="line"># 括号优先级最高; 若不熟悉运算符的优先级, 可以直接打括号</span><br><span class="line">exp1 <span class="keyword">AND</span> exp2       # 逻辑与</span><br><span class="line">exp1 <span class="keyword">OR</span> exp2       # 逻辑或</span><br><span class="line"><span class="keyword">NOT</span> exp         # exp的否定</span><br><span class="line"></span><br><span class="line"># 在<span class="keyword">condition</span>后可添加<span class="keyword">ORDER</span> <span class="keyword">BY</span>语句, 表示按列排序</span><br><span class="line"># 默认为<span class="keyword">ASC</span>(上到下升序), <span class="keyword">DESC</span>为上到下降序</span><br><span class="line"># 若有复数个列, 则按顺序排序(可认为是先排最后列, 再排第一列)</span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> ... <span class="keyword">WHERE</span> ... <span class="keyword">ORDER</span> <span class="keyword">BY</span> columnNames <span class="keyword">ASC</span> <span class="operator">/</span> <span class="keyword">DESC</span>;</span><br><span class="line"># 例: 对下表查询<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> name, id; (先排id, 再排name)</span><br><span class="line">id <span class="operator">|</span> name <span class="comment">---&gt; id | name ---&gt; id | name</span></span><br><span class="line"><span class="number">3</span>  a    <span class="number">1</span>  b    <span class="number">2</span>  a</span><br><span class="line"><span class="number">1</span>  b    <span class="number">2</span>  a    <span class="number">3</span>  a</span><br><span class="line"><span class="number">2</span>  a    <span class="number">3</span>  a    <span class="number">1</span>  b</span><br><span class="line"></span><br><span class="line"># 起别名:</span><br><span class="line"># 在查询语句中, 所有涉及表名、列名的语句, 可在名字后添加 <span class="keyword">AS</span> 别名, 查询结果将使用别名</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a <span class="keyword">AS</span> newName;</span><br></pre></td></tr></table></figure>
<p><code>LIKE</code>通配符：</p>
<ul>
<li><code>%</code>：匹配任意数目的字符</li>
<li><code>_</code>：匹配单个字符</li>
<li>若字段中含通配符，可通过<code>ESCAPE</code>转义字符：<code>LIKE 'a\_b' ESCAPE '\'</code></li>
</ul>
<h3 id="对表内容的操作">对表内容的操作</h3>
<p>对表内容的操作一定记得联合查询语句一起使用，否则可能会修改所有记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 更改记录内容</span><br><span class="line"># <span class="keyword">WHERE</span>指定要修改的行, <span class="keyword">SET</span>指定要修改的列</span><br><span class="line"><span class="keyword">UPDATE</span> tableName <span class="keyword">SET</span> column1<span class="operator">=</span>value1,...,columnN<span class="operator">=</span>valueN <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"># 删除具体记录(配合查询语句)</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tableName <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br><span class="line"></span><br><span class="line"># 插入新记录</span><br><span class="line"><span class="keyword">INSERT</span> tableName (columnList) <span class="keyword">VALUES</span> (valueList);</span><br><span class="line"></span><br><span class="line"># 以上为对列进行修改的语句, 而更新表的列需要用到<span class="keyword">ALTER</span>系列语句</span><br><span class="line"># 添加列</span><br><span class="line"><span class="keyword">ALTER TABLE</span> tableName <span class="keyword">ADD</span> columnName valueType</span><br><span class="line"></span><br><span class="line"># 删除列(SQLite不支持)</span><br><span class="line"><span class="keyword">ALTER TABLE</span> tableName <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> columnName</span><br><span class="line"></span><br><span class="line"># 更改列的数据类型及其约束</span><br><span class="line"><span class="keyword">ALTER TABLE</span> tableName MODIFY <span class="keyword">COLUMN</span> columnName valueType</span><br><span class="line"></span><br><span class="line"># 修改列名</span><br><span class="line"><span class="keyword">ALTER TABLE</span> tableName CHANGE columnName newName;</span><br><span class="line"></span><br><span class="line"># 需要检查的情况(需要设置主键约束):</span><br><span class="line"># 记录不存在则插入、存在则更新</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">OR</span> REPLACE <span class="keyword">INTO</span> ...  # SQLite</span><br><span class="line">REPLACE <span class="keyword">INTO</span> ...    # MySQL</span><br><span class="line"><span class="keyword">INSERT</span> IGNORE <span class="keyword">INTO</span> ...   # 记录不存在则插入、存在则忽略操作</span><br></pre></td></tr></table></figure>
<h3 id="对表整体的操作">对表整体的操作</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 创建表</span><br><span class="line"># 列名不是数据, 不用加引号</span><br><span class="line"><span class="keyword">CREATE TABLE</span> tableName (</span><br><span class="line"> columnName dataType,   # 列名 该列的数据类型 逗号分隔开不同列</span><br><span class="line">    ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 用oldTable的查询结果作为内容, 创建新表</span><br><span class="line"><span class="keyword">CREATE TABLE</span> newTable <span class="keyword">AS</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> oldTable;</span><br><span class="line"></span><br><span class="line"># 用oldTable的查询结果作为内容, 插入 已创建 的表里</span><br><span class="line"><span class="keyword">INSERT INTO</span> exTable (columnList) <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> oldTable;</span><br><span class="line"></span><br><span class="line"># 修改表名</span><br><span class="line"><span class="keyword">ALTER TABLE</span> tableName RENAME <span class="keyword">TO</span> newName;</span><br><span class="line"></span><br><span class="line"># 删除表</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> tableName;</span><br><span class="line"></span><br><span class="line"># 删除表的所有数据, 保留表</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> tableName;   # 一次性删除所有记录</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tableName;    # 找出所有行, 逐个删除(<span class="keyword">DELETE</span>还可用于删除特定行)</span><br></pre></td></tr></table></figure>
<h3 id="部分关键字">部分关键字</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 创建<span class="operator">/</span>删除表时, 判断表是否不存在<span class="operator">/</span>存在:</span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> ...;   # 若表不存在, 才创建</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> ...;    # 若表存在, 才删除</span><br><span class="line"></span><br><span class="line"># 数据的约束(创建表时, 在数据类型后指定; 或者使用<span class="keyword">ALTER</span> ... MODIFY修改)</span><br><span class="line"><span class="keyword">NOT NULL</span>       # 该列数据一定非空</span><br><span class="line"><span class="keyword">UNIQUE</span>        # 该列数据各不相同</span><br><span class="line"><span class="keyword">PRIMARY KEY</span>       # 主键约束:该列数据各不相同, 且不为空</span><br><span class="line"><span class="keyword">DEFAULT</span> <span class="keyword">value</span>      # 插入记录时, 若未指定该列的值, 则使用默认值<span class="keyword">value</span></span><br><span class="line">AUTO_INCREMENT      # 用于整型的自动增长</span><br><span class="line">COMMENT        # 注释(放在最后)</span><br><span class="line"></span><br><span class="line"># 格式特殊的外键约束:</span><br><span class="line"># 用于绑定两表的两列, 本表是从表, otherTable是主表</span><br><span class="line"># 从表添加记录时, 外键约束列的数据必须存在于主表内</span><br><span class="line"># 从表删除记录时, 主表对应的记录不删除</span><br><span class="line"><span class="keyword">FOREIGN KEY</span> columnName <span class="keyword">REFERENCES</span> otherTable(columnName) dataType;</span><br><span class="line"># 外键约束的关键字:</span><br><span class="line">CASCADE  # 主表修改<span class="operator">/</span>删除记录时, 从表对应外键字段随之修改<span class="operator">/</span>删除, 常用</span><br><span class="line">RESTRICT # 和CASCADE相反</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NULL</span> # 主表删除记录时, 从表对应外键字段设置为空</span><br><span class="line"># 也可将修改和删除拆开:</span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE <span class="operator">/</span> <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE <span class="operator">/</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> RESTRICT <span class="operator">/</span> <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT</span><br><span class="line"></span><br><span class="line"># 可以在数据类型后指定, 也可以在后面批量设置约束:</span><br><span class="line"><span class="keyword">CREATE</span> ... (</span><br><span class="line"> ...,</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> 约束名 <span class="keyword">UNIQUE</span> (要添加的列)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="qt-sql"><code>Qt Sql</code></h2>
<h3 id="前言">前言</h3>
<p><code>Qt</code>提供了两种通过<code>C++</code>修改数据库的方法：一是模型/视图套件；二是提供查询接口，直接输入<code>SQL</code>语句</p>
<p>它对<code>SQLite</code>的支持是最好的，可直接使用；而有些数据库的驱动需要自行编译，例如<code>MySQL</code></p>
<p><strong><a
target="_blank" rel="noopener" href="https://www.cnblogs.com/zhuchunlin/p/16485929.html"><code>MySQL</code>驱动编译</a></strong></p>
<h3 id="qsqldatabase"><code>QSqlDatabase</code></h3>
<p>该类的对象是将数据从硬盘加载到内存上的桥梁</p>
<p>连接数据库：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以连接SQLite为例</span></span><br><span class="line">QSqlDatabase db = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QSQLITE&quot;</span>); <span class="comment">// 创建数据库对象</span></span><br><span class="line">db.<span class="built_in">setHostName</span>(<span class="string">&quot;127.0.0.1&quot;</span>); <span class="comment">// 设置主机名</span></span><br><span class="line">db.<span class="built_in">setPort</span>(<span class="number">3306</span>);    <span class="comment">// 设置端口</span></span><br><span class="line">db.<span class="built_in">setUserName</span>(<span class="string">&quot;root&quot;</span>);   <span class="comment">// 设置拥有者名</span></span><br><span class="line">db.<span class="built_in">setPassword</span>(<span class="string">&quot;1&quot;</span>);   <span class="comment">// 设置密码</span></span><br><span class="line">db.<span class="built_in">setDatabase</span>(<span class="string">&quot;mdb.db&quot;</span>);  <span class="comment">// 设置数据库路径; SQLite是一个.db文件</span></span><br><span class="line">db.<span class="built_in">open</span>();      <span class="comment">// 打开数据库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 含lastError()方法:返回该对象最近发生的错误, 若一切正常则返回空串</span></span><br></pre></td></tr></table></figure>
<h3 id="qt-query"><code>Qt Query</code></h3>
<p>在<code>Qt</code>中，可直接利用<code>QSqlQuery</code>对象操作数据库</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">QSqlQuery* query &#123;<span class="keyword">new</span> <span class="built_in">QSqlQuery</span>(db)&#125;;  <span class="comment">// 绑定QSqlDatabase对象即可</span></span><br><span class="line">query-&gt;<span class="built_in">exec</span>(<span class="string">&quot;SQL语句&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历查询结果</span></span><br><span class="line"><span class="keyword">while</span> (query-&gt;<span class="built_in">next</span>()) &#123;</span><br><span class="line">    query-&gt;<span class="built_in">value</span>(列名);  <span class="comment">// 返回QVariant, 存储第i条记录中指定列的数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也含lastError()方法</span></span><br></pre></td></tr></table></figure>
<h3 id="qt-modelviewdelegate"><code>Qt Model/View/Delegate</code></h3>
<p>模型是为了操作数据库而提供的接口，视图能让用户直观地操作数据库，有两种常用模型和视图</p>
<p>所有模型都有<code>lastError()</code>方法</p>
<p><strong>委托</strong>是模型和视图的中间层，用于<strong>渲染视图</strong>和<strong>编辑模型</strong></p>
<h4
id="qsqltablemodelqtableview"><code>QSqlTableModel/QTableView</code></h4>
<p>以表为结构的模型/以表形式展现的视图</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// QTableView控件一般在QD中绘制, 这里假设它是ui-&gt;tv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备</span></span><br><span class="line">QSqlTableModel* model &#123;<span class="keyword">new</span> <span class="built_in">QSqlTableModel</span>(<span class="keyword">this</span>, db); &#125; <span class="comment">// 指定父组件和数据库</span></span><br><span class="line">model-&gt;<span class="built_in">setEditStrategy</span>(QSqlTableModel::OnManualSubmit); <span class="comment">// 一般要设置手动提交</span></span><br><span class="line">model-&gt;<span class="built_in">setTable</span>(<span class="string">&quot;tableName&quot;</span>);  <span class="comment">// 模型要设置数据库的表的名称</span></span><br><span class="line">model-&gt;<span class="built_in">select</span>();     <span class="comment">// 将数据加载进模型</span></span><br><span class="line">ui-&gt;tv-&gt;<span class="built_in">setModel</span>(model);   <span class="comment">// 视图要绑定模型:表-&gt;模型-&gt;视图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过模型修改数据库</span></span><br><span class="line">model-&gt;<span class="built_in">index</span>(<span class="type">int</span>, <span class="type">int</span>)    <span class="comment">// 返回QModelIndex对象(0开始)</span></span><br><span class="line">    <span class="built_in">rowCount</span>() / <span class="built_in">columnCount</span>() <span class="comment">// 返回当前行/列数</span></span><br><span class="line">       <span class="built_in">data</span>(QModelIndex)   <span class="comment">// 返回索引指向的数据(类型为QVariant)</span></span><br><span class="line">       <span class="built_in">removeRow</span>(<span class="type">int</span>)/<span class="built_in">removeColumn</span>(<span class="type">int</span>) <span class="comment">// 删除某行/列</span></span><br><span class="line">       <span class="built_in">submitAll</span>()     <span class="comment">// 提交所有修改(真正修改数据库)</span></span><br><span class="line">       <span class="built_in">revertAll</span>()     <span class="comment">// 撤销所有修改(停止事务)</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 通过视图修改模型</span></span><br><span class="line">ui-&gt;tv-&gt;<span class="built_in">currentIndex</span>()    <span class="comment">// 返回QModelIndex, 表示用户选中的格子</span></span><br><span class="line">     <span class="built_in">setCurrentIndex</span>(QModelIndex)<span class="comment">// 设置选中格</span></span><br><span class="line"><span class="comment">// 模型调用方法后, 当前选中的信息可能丢失</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 关于QVariant和QModelIndex:</span></span><br><span class="line"><span class="comment">// QVariant含toString()和toInt()等方法, 能将字段转换成QString和int等数据类型</span></span><br><span class="line"><span class="comment">// QModelIndex含row()和column()方法, 返回对象包含的行/列信息</span></span><br></pre></td></tr></table></figure>
<p>关于视图单元格的选中模式(枚举<code>QAbstractItemView::SelectionMode</code>)：</p>
<ul>
<li><code>NoSelection</code>：无法选中</li>
<li><code>SingleSelection</code>：只能单选</li>
<li><code>MultiSelection</code>：允许多选</li>
<li><code>ExtendedSelection</code>：允许配合<code>Ctrl</code>或<code>Shift</code>键进行选择</li>
<li><code>ContiguousSelection</code>：允许配合<code>Ctrl+Shift</code>键进行批量选择</li>
</ul>
<p>如果需要设置某列不可选中，可使用自定义委托：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReadOnlyDelegate</span>: <span class="keyword">public</span> QItemDelegate &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ReadOnlyDelegate</span>(QWidget *parent = <span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">QWidget *<span class="title">createEditor</span><span class="params">(QWidget *parent, <span class="type">const</span> QStyleOptionViewItem &amp;option,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">const</span> QModelIndex &amp;index)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="built_in">Q_UNUSED</span>(parent)</span><br><span class="line">        <span class="built_in">Q_UNUSED</span>(option)</span><br><span class="line">        <span class="built_in">Q_UNUSED</span>(index)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 令委托无视掉指定列的选中</span></span><br><span class="line">ReadOnlyDelegate* readOnlyDelegate = <span class="keyword">new</span> <span class="built_in">ReadOnlyDelegate</span>(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">1</span>; i &lt; <span class="number">3</span>; ++i) &#123; <span class="comment">// 无视</span></span><br><span class="line">    ui-&gt;matrixTable-&gt;<span class="built_in">setItemDelegateForColumn</span>(i, readOnlyDelegate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4
id="qstandarditemmodelqtreeview"><code>QStandardItemModel/QTreeView</code></h4>
<p><code>QStandardItemModel</code>是以项为基础的模型，主从结构分明，很适合展示<strong>树形结构</strong></p>
<p>它的编辑要比<code>QSqlTableView</code>复杂，不能直接通过<code>select()</code>(也没有<code>setTable()</code>方法)完成数据的加载，而要使用<code>QSqlQuery</code>，因此单纯的矩阵结构应该用后者绘制</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 准备</span></span><br><span class="line">...   <span class="comment">// 构造函数、设置手动提交、视图和模型绑定 与上述一致</span></span><br><span class="line">ManageModel-&gt;<span class="built_in">setColumnCount</span>(<span class="number">2</span>);  <span class="comment">// 设置模型共有两列</span></span><br><span class="line">ManageModel-&gt;<span class="built_in">setHorizontalHeaderLabels</span>(&#123;<span class="string">&quot;用户组&quot;</span>, <span class="string">&quot;组权限&quot;</span>&#125;); <span class="comment">// 设置这两列的名称</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 例如要绘制二层的树结构, 表group和member如下:</span></span><br><span class="line">group:</span><br><span class="line">gid  grpname  power  memberCnt</span><br><span class="line">    </span><br><span class="line">member:</span><br><span class="line">uid  grp_id[含<span class="built_in">group</span>(gid)的外键约束] username pwd</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载, 假设有QStandardItemModel对象的指针model:</span></span><br><span class="line">QSqlQuery group&#123;db&#125;, member&#123;db&#125;;</span><br><span class="line">group.<span class="built_in">exec</span>(<span class="string">&quot;SELECT gid, grpname FROM group&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (group.<span class="built_in">next</span>()) &#123;</span><br><span class="line">    QList&lt;QStandardItem*&gt; rowItems; <span class="comment">// 因设置了两列, 故插入的是链表</span></span><br><span class="line">    <span class="keyword">auto</span> tmpItem &#123;<span class="keyword">new</span> <span class="built_in">QStandardItem</span>(qroup.<span class="built_in">value</span>(<span class="string">&quot;grpname&quot;</span>).<span class="built_in">toString</span>())&#125;;</span><br><span class="line">    <span class="comment">// 树的第一层是 组名 和 组权限</span></span><br><span class="line">    rowItems &lt;&lt; tmpItem &lt;&lt; <span class="keyword">new</span> <span class="built_in">QStandardItem</span>(group.<span class="built_in">value</span>(<span class="string">&quot;power&quot;</span>).<span class="built_in">toInt</span>());</span><br><span class="line">    <span class="comment">// 查询当前组的组员</span></span><br><span class="line">    member.<span class="built_in">exec</span>(<span class="string">&quot;SELECT username FROM member WHERE grp_id=&quot;</span> +</span><br><span class="line">                QString::<span class="built_in">number</span>(group.<span class="built_in">value</span>(<span class="string">&quot;gid&quot;</span>).<span class="built_in">toInt</span>()));</span><br><span class="line">    <span class="keyword">while</span> (member.<span class="built_in">next</span>()) &#123;</span><br><span class="line">        <span class="comment">// 增加子项(树的第二层 用户名)</span></span><br><span class="line">        tmpItem-&gt;<span class="built_in">appendRow</span>(<span class="keyword">new</span> <span class="built_in">QStandardItem</span>(member.<span class="built_in">value</span>(<span class="string">&quot;username&quot;</span>).<span class="built_in">toString</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    model-&gt;<span class="built_in">appendRow</span>(rowItems);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 项一旦加入模型, 所有权将移交, 模型内存释放时所有项一同释放</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 树形视图的方法:</span></span><br><span class="line">tv-&gt;<span class="built_in">expandAll</span>()    <span class="comment">// 展开所有项</span></span><br><span class="line"> <span class="built_in">collapseAII</span>()   <span class="comment">// 折叠所有项</span></span><br></pre></td></tr></table></figure>
<p><a
target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40597070/article/details/131542928">树形视图的更多方法</a></p>
<p><a
target="_blank" rel="noopener" href="https://www.cnblogs.com/zhuchunlin/p/16485926.html">更多模型/视图</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="sidebar-inner sidebar-post-related">
            <div class="animated">
                <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    Related Posts
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/06/02/java-jdbc/" rel="bookmark">
        <time class="popular-posts-time">2025-06-02</time>
        <br>
      Java: JDBC编程
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/04/20/sql-std/" rel="bookmark">
        <time class="popular-posts-time">2025-04-20</time>
        <br>
      SQL: 基本用法
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2024/06/27/cpp-qt-beginner/" rel="bookmark">
        <time class="popular-posts-time">2024-06-27</time>
        <br>
      Qt: 基本用法
      </a>
    </li>
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/2025/11/26/Rlang-beginner/" rel="bookmark">
        <time class="popular-posts-time">2025-11-26</time>
        <br>
      Rlang: 虽然不知道为什么要学
      </a>
    </li>
  </ul>

            </div>
          </div>

          <div class="post-tags">
              <a href="/tags/Qt/" rel="tag"># Qt</a>
              <a href="/tags/databse/" rel="tag"># databse</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/06/27/cpp-qt-beginner/" rel="prev" title="Qt: 基本用法">
                  <i class="fa fa-angle-left"></i> Qt: 基本用法
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/07/15/cpp-effective-moderncpp-reaction/" rel="next" title="Cpp: Effective Modern C++阅读笔记">
                  Cpp: Effective Modern C++阅读笔记 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ishio</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">241k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">14:38</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script>
(function() {
    if (document.readyState !== 'loading') {
        initCategoryCollapse();
    } else {
        document.addEventListener('DOMContentLoaded', initCategoryCollapse);
    }

    function initCategoryCollapse() {
        var categoryItems = document.querySelectorAll('.category-all-page .category-list-item');
        
        categoryItems.forEach(function(item) {
            var childList = item.querySelector('.category-list-child');
            
            if (childList) {
                var titleLink = item.querySelector('.category-list-link');
                if (!titleLink) return;
                
                item.classList.add('has-child');
                
                var toggleIcon = document.createElement('span');
                toggleIcon.className = 'collapse-icon';
                toggleIcon.innerHTML = ' ▸';
                titleLink.parentNode.insertBefore(toggleIcon, titleLink.nextSibling);
                
                childList.style.display = 'none';
                item.classList.add('collapsed');
                
                titleLink.style.cursor = 'pointer';
                titleLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    item.classList.toggle('collapsed');
                    if (item.classList.contains('collapsed')) {
                        childList.style.display = 'none';
                        toggleIcon.innerHTML = ' ▸';
                    } else {
                        childList.style.display = 'block';
                        toggleIcon.innerHTML = ' ▾';
                    }
                });
                
                toggleIcon.style.cursor = 'pointer';
                toggleIcon.addEventListener('click', function(e) {
                    e.stopPropagation();
                    titleLink.click();
                });
            }
        });
    }
})();
</script>

</body>
</html>
